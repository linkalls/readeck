{*
SPDX-FileCopyrightText: Â© 2021 Olivier Meunier <olivier@neokraft.net>

SPDX-License-Identifier: AGPL-3.0-only
*}
{{- block formErrors(form) -}}
  {{- if !form.IsValid() -}}
    <div class="max-w-xl">
    {{- yield message(type="error") content -}}
      <strong class="text-red-700">Errors</strong>
      {{- if form.Errors() -}}
        {{ range form.Errors() }}
          <p>{{ .Error() }}</p>
        {{- end -}}
      {{ else }}
        <p>Please check your form for errors.</p>
      {{ end }}
    {{- end -}}
    </div>
  {{- end -}}
{{- end -}}


{{- block formField(field, name, label, help, class="", controlAttrs=attrList()) -}}
  {{- if !name -}}{{ name = field.Name() }}{{- end -}}
  {{- if field.Errors -}}{{ class = class + " field-err" }}{{- end -}}

  <div class="field{{ if class }} {{ class }}{{ end }}">
    <label for="{{ name }}">{{ label }}:</label>
    <div class="flex-grow" {{ controlAttrs }}>
      {{ yield content }}
      {{ if field.Errors }}
        <ul class="mt-1 list-disc list-inside text-red-700">
        {{- range field.Errors }}
          <li>{{ . }}</li>
        {{ end -}}
        </ul>
      {{ end }}
      {{ if help }}<span class="block mt-1 text-green-700">{{ help }}{{ end }}
    </div>
  </div>
{{- end -}}


{{- block textField(
  field, value=nil, type="text", name, label, class="", help,
  controlAttrs=attrList(), inputAttrs=attrList(), inputClass="form-input w-full"
) -}}
  {{- if type == "password" -}}
    {{ value = "" }}
  {{- else if value == nil -}}
    {{ value = field.String() }}
  {{- end -}}

  {{- yield formField(field=field, name=name, label=label, help=help, class=class,
                      controlAttrs=controlAttrs) content -}}
    <input type="{{ type }}" id="{{ name }}" name="{{ name }}"
     value="{{ value }}" class="{{ inputClass }}" {{ inputAttrs }} />
  {{- end -}}
{{- end -}}


{{- block dateField(
  field, value=nil, name, label, class, help,
  controlAttrs=attrList(), inputAttrs=attrList(), inputClass="form-input",
) -}}
  {{ value = field.String() }}
  {{ yield textField(field=field, value=value, type="date", name=name,
                     label=label, class=class, help=help,
                     controlAttrs=controlAttrs, inputAttrs=inputAttrs,
                     inputClass=inputClass) }}
{{- end -}}


{{- block checkboxField(
  field, checked=nil, name, label, class="", help
) -}}
  {{- if !name -}}{{ name = field.Name() }}{{- end -}}
  {{- if checked == nil }}{{ checked = field.Value() }}{{ end -}}
  {{- if field.Errors -}}{{ class = class + " with-errors" }}{{ end }}
  <div class="field{{ if class }} {{ class }}{{ end }}">
    <span class="field-spacer">&nbsp;</span>
    <div class="control">
      <input type="hidden" name="{{ name }}" value="f" />
      <input type="checkbox" id="{{ name }}" name="{{ name }}"
       class="form-checkbox" value="t"
       {{- if checked }} checked="checked"{{ end -}} />
      <label class="font-bold" for="{{ name }}">{{ label }}</label>
      {{ if field.Errors }}
        <ul class="mt-1 list-disc list-inside text-red-700">
        {{- range field.Errors }}
          <li>{{ . }}</li>
        {{ end -}}
        </ul>
      {{ end }}
      {{ if help }}<span class="block mt-1 text-green-700">{{ help }}{{ end }}
    </div>
  </div>
{{- end -}}


{{- block selectField(
  field, value=nil, name, options, label, class, help,
  controlAttrs=attrList(), inputAttrs=attrList(), inputClass="form-select w-full"
) -}}
  {{- if !name -}}{{ name = field.Name() }}{{- end -}}
  {{- if value == nil -}}{{ value = field.Value() }}{{- end -}}
  {{- if !options -}}{{ options = field.Choices() }}{{- end -}}
  {{- if field.Errors -}}{{ class = class + " with-errors" }}{{ end }}
  {{- yield formField(field=field, name=name, label=label, help=help, class=class,
                      controlAttrs=controlAttrs) content -}}
    <select name="{{ name }}" id="{{ name }}" class="{{ inputClass }}" {{ inputAttrs }}>
      {{- range options -}}
        <option value="{{ .[0] }}" {{ if string(value) == string(.[0]) }}selected="selected"{{ end }}>{{ .[1] }}</option>
      {{- end -}}
    </select>
  {{- end -}}
{{- end -}}

{{- block multiSelectField(
  field, name, label, class, help
) -}}
  {{- if !name -}}{{ name = field.Name() }}{{- end -}}
  {{- if field.Errors -}}{{ class = class + " field-err" }}{{- end -}}
  <div class="field{{ if class }} {{ class }}{{ end }}">
    <label>{{ label }}:</label>
    <div class="flex-grow">
      <input type="hidden" name="{{ name }}" value="">
      <ul>
        {{- range field.Field.Choices() -}}
         <li class="mb-2">
          <input type="checkbox" name="{{ name }}" id="{{ name }}_{{ .[0] }}" value="{{ .[0] }}"
           class="form-checkbox"
           {{ if field.Field.InChoices(.[0]) }} checked{{ end }}>
          <label for="{{ name }}_{{ .[0] }}">{{ .[1] }}</label>
         </li>
        {{- end -}}
      </ul>
      {{ if field.Errors }}
        <ul class="mt-1 list-disc list-inside text-red-700">
        {{- range field.Errors }}
          <li>{{ . }}</li>
        {{ end -}}
        </ul>
      {{ end }}
      {{ if help }}<span class="block mt-1 text-green-700">{{ help }}{{ end }}
    </div>
  </div>
{{- end -}}
