{{ extends "./base" }}
{{- import "/_libs/forms" -}}


{{- block title() -}}
    {{ .Item.Name }} - Collections
{{- end -}}

{{- block mainContent() -}}
<h1 class="title text-h2">Collection {{ .Item.Name }}</h1>

{{- if .Item.IsDeleted -}}
  <form action="{{ urlFor(`./delete`) }}" method="post">
    {{ yield csrfField() }}
    <input type="hidden" name="_to" value="{{ currentPath }}" />
    {{- yield message(type="info") content -}}
      Collection will be removed in a few seconds&nbsp;
      <button class="btn-primary" name="cancel" value="1">Cancel</button>
    {{- end -}}
  </form>
{{- else -}}
  <turbo-frame id="bookmark-list"
  data-controller="turbo-refresh"
  data-turbo-refresh-interval-value="10"
  data-turbo-refresh-on-value="[data-bookmark-deleted='true']">
    <form action="{{ urlFor() }}?edit=1" method="post"
     class="my-4 p-2 bg-gray-100 border rounded">
      {{ yield formErrors(form=.Form) }}
      {{ yield csrfField() }}
      <details {{- if .Editing }} open{{- end -}}>
        <summary class="block link font-semibold"
        >{{- yield icon(name="o-pencil") -}} Edit</summary>
        <div class="text-sm mt-2">
          <div class="grid grid-cols-3 gap-2 max-md:grid-cols-2">
            {{ yield textField(
              field=.Form.Get("name"),
              label="Name",
              class="mb-0 col-span-3 max-md:col-span-2",
            ) }}
            {{ yield textField(
              field=.Form.Get("search"),
              label="Search",
              class="mb-0 col-span-3 max-md:col-span-2",
            ) }}
            {{ yield textField(
              field=.Form.Get("title"),
              label="Title",
              class="mb-0",
            ) }}
            {{ yield textField(
              field=.Form.Get("author"),
              label="Author",
              class="mb-0",
            ) }}
            {{ yield textField(
              field=.Form.Get("site"),
              label="Site",
              class="mb-0",
            ) }}

            {{ yield textField(
              field=.Form.Get("labels"),
              label="Label",
              class="mb-0",
            ) }}

            <div class="col-span-2 flex flex-wrap gap-2">
              {{ yield selectField(
                field=.Form.Get("is_marked"),
                label="Is Favourite",
                class="mb-0",
                options=slice(slice("", ""), slice(true, "yes"), slice(false, "no")),
              ) }}
              {{ yield selectField(
                field=.Form.Get("is_archived"),
                label="Is Archived",
                class="mb-0",
                options=slice(slice("", ""), slice(true, "yes"), slice(false, "no")),
              ) }}

              {{ yield selectField(
                field=.Form.Get("type"),
                label="Type",
                class="mb-0",
              ) }}
            </div>
          </div>
          <div class="mt-2 flex">
            <p class="flex-grow">
              <button class="btn btn-primary">Save</button>
            </p>
            <p>
              <button class="btn-danger" formaction="{{ urlFor(`./delete`) }}" formmethod="post"
              >{{ yield icon(name="o-trash") }} Delete collection</button>
            </p>
          </div>
        </div>
      </details>
    </form>

    {{- if hasPermission("api:bookmarks", "export") -}}
      <p class="mt-4 mb-6">
        <span class="font-semibold">{{ yield icon(name="o-download") }}
        Export this collection</span>:
        <a href="{{ urlFor(`/api/bookmarks/export.epub`) }}?collection={{ .Item.ID }}"
         class="link">Epub</a>
      </p>
    {{- end }}

    {{- include "/_libs/pagination" .Pagination -}}

    <div class="my-4 grid lg:grid-cols-cards gap-4">
    {{- range .Bookmarks -}}
      {{- include "./components/card" . -}}
    {{- end -}}
    </div>

    {{- include "/_libs/pagination" .Pagination -}}
  </turbo-frame>
{{- end -}}
{{- end -}}
