{*
SPDX-FileCopyrightText: Â© 2023 Olivier Meunier <olivier@neokraft.net>

SPDX-License-Identifier: AGPL-3.0-only
*}
{{ import "../../_libs/common" }}

{{- if .Item.Type == "photo" && isset(.Item.Resources.image) -}}
  <figure class="mb-8">
    <img alt="" src="{{ .Item.Resources.image.Src }}"
    class="mx-auto"
    width="{{ .Item.Resources.image.Width }}" height="{{ .Item.Resources.image.Height }}">
  </figure>
{{- else if .Item.Type == "video" && isset(.Item.Resources.image) && .Item.Embed -}}
  <div class="video-player mb-8" data-controller="video">
    <img alt="" src="{{ .Item.Resources.image.Src }}"
      width="{{ .Item.Resources.image.Width }}" height="{{ .Item.Resources.image.Height }}">
    <template data-video-target="embed">
      {{- raw(.Item.Embed) -}}
    </template>
    <template data-video-target="play">
      <button class="play-button"
       data-action="{{ if !.Item.HasArticle }}click->scroll-progress#setPosition {{ end -}} click->video#play"
       data-scroll-progress-position-param="100"
      >
        <span></span>
      </button>
    </template>
  </div>
{{- end -}}

{{- if .Item.HasArticle -}}
<turbo-frame id="bookmark-content-{{ .Item.ID }}"
 src="{{ urlFor(`/api/bookmarks`, .Item.ID) }}/article"
 disabled
 data-controller="annotations"
 data-action="request:annotation-removed@document->annotations#reload"
 data-annotations-api-url-value="{{ urlFor(`/api/bookmarks`, .Item.ID) }}/annotations"
 data-annotations-hidden-class="hidden"
>
<div class="bookmark-article max-w-3xl mx-auto print:max-w-none relative">
  <div class="hidden absolute z-50"
    data-annotations-target="controlls">
      <div class="flex items-center gap-4 px-6 py-3 bg-gray-700 dark:bg-gray-300 rounded-full shadow-lg"
        data-annotations-target="controllCreate">
        <button class="w-4 h-4 bg-yellow-700 rounded-full focus:outline-none hover:opacity-80"
         data-action="click->annotations#save"
        data-annotations-color-value="yellow"></button>
        <button class="w-4 h-4 bg-red-700 rounded-full focus:outline-none hover:opacity-80"
         data-action="click->annotations#save"
        data-annotations-color-value="red"></button>
        <button class="w-4 h-4 bg-blue-700 rounded-full focus:outline-none hover:opacity-80"
         data-action="click->annotations#save"
        data-annotations-color-value="blue"></button>
        <button class="w-4 h-4 bg-green-700 rounded-full focus:outline-none hover:opacity-80"
        data-annotations-target="controllCreate" data-action="click->annotations#save"
        data-annotations-color-value="green"></button>
      </div>
      <button data-annotations-target="controllDelete" data-action="click->annotations#delete"
      class="p-4 bg-red-800 text-red-100 hf:text-white rounded-lg shadow-lg
      dark:bg-red-400 dark:text-gray-900 dark:hf:text-white"
      title="remove highlight(s)">{{ yield icon(name="o-trash") }} {{ gettext("Remove Highlight(s)") }}</button>
  </div>

  <div class="
    prose
    {{ preferences.ReaderFont().Class }}
    {{ preferences.ReaderFontSize().Class }}
    {{ preferences.ReaderLineHeight().Class }}
    {{ preferences.ReaderJustify().Class }}
    {{ preferences.ReaderHyphenation().Class }}
    overflow-x-auto
    "
    lang="{{ .Item.Lang }}"
    dir="{{ default(.Item.TextDirection, `ltr`) }}"
    data-controller="styler"
    data-annotations-target="root"
    data-scroll-progress-target="tracked">
    {{- unsafeWrite(.HTML) -}}
  </div>
  {{- include "./bookmark_qrcode" }}
</div>
</turbo-frame>
{{- else -}}
  {{- include "./bookmark_qrcode" }}
{{- end -}}
